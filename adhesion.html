<!DOCTYPE html>
<html lang="fr">
  <head>
    <base target="_top">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Adhésion à l’ASA — Association des Sénégalais d’Amiens</title>

    <!-- SEO -->
    <meta name="description" content="Formulaire d’adhésion à l’Association des Sénégalais d’Amiens (ASA). Rejoignez notre communauté à Amiens et dans la Somme / Oise / Aisne." />
    <meta name="robots" content="noindex,follow" />
    <link rel="canonical" href="https://asso-asa.github.io/asa/adhesion.html" />

    <!-- Open Graph / Twitter -->
    <meta property="og:title" content="Adhésion à l’ASA — Association des Sénégalais d’Amiens" />
    <meta property="og:description" content="Rejoignez la communauté de l’ASA. Formulaire d’adhésion en ligne." />
    <meta property="og:image" content="https://asso-asa.github.io/asa/img/logotype-asa-1200x630.png" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="fr_FR" />
    <meta name="twitter:card" content="summary_large_image" />

    <!-- Favicons / Manifest -->
    <link rel="icon" href="/asa/img/favicon-32x32.png" sizes="32x32" type="image/png" />
    <link rel="icon" href="/asa/img/favicon-16x16.png" sizes="16x16" type="image/png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/asa/img/TILBILO-logo-180x180.png" />
    <link rel="manifest" href="/asa/manifest.json" />
    <meta name="theme-color" content="#00853F" />

    <!-- CSS -->
    <link rel="stylesheet" href="/asa/style.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
  </head>

  <body>
    <div class="bg-light container mt-5 mb-5 form-container p-4 shadow rounded">
      <img class="img-fluid mx-auto d-block mon-image" src="https://res.cloudinary.com/dcjlu0ems/image/upload/v1737277427/logo_asa_2025.png" alt="Logo de l’ASA" />
      <hr />
      <h2 class="text-center mb-4 mt-4 text-primary mon-titre">Adhérer à l’ASA — Formulaire d’inscription</h2>

      <p>L’Association des Sénégalais d’Amiens (ASA) rassemble les Sénégalais·es résidant·es à Amiens et dans les départements de la Somme (80), de l’Oise (60) et de l’Aisne (02).</p>
      <p><strong>Remplissez ce formulaire pour devenir membre et participer à la vie de notre communauté.</strong></p>
      <p class="text-danger"><em>Vos données sont traitées de manière confidentielle et uniquement pour votre adhésion.</em></p>
      <hr />

      <!-- ACTION = Web App GAS -->
      <form class="pt-2" id="asaForm" action="https://script.google.com/macros/s/AKfycbx0w2NsM2oaPT_YWDVM0QHMJFgHHlaT7Qy5QdSvQy3NwJMo-FgRwm5P_UWkgclbNG73aA/exec" method="POST" enctype="multipart/form-data">
        <!-- Identité -->
        <div class="row">
          <div class="col-md-6">
            <div class="form-group mb-3">
              <label class="form-label" for="prenom">Prénom·s <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="prenom" name="prenom" required />
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group mb-3">
              <label class="form-label" for="nom">Nom <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="nom" name="nom" required />
            </div>
          </div>
        </div>

        <!-- Contacts -->
        <div class="row">
          <div class="col-md-6">
            <div class="form-group mb-3">
              <label class="form-label" for="telephone">Numéro de téléphone (WhatsApp) <span class="text-danger">*</span></label>
              <input type="tel" maxlength="20" placeholder="+33 6 12 34 56 78" class="form-control" id="telephone" name="telephone" required />
              <small class="text-muted">Utilisez le format international si possible (ex. +33...).</small>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group mb-3">
              <label class="form-label" for="email">Adresse e-mail</label>
              <input type="email" class="form-control" id="email" name="email" />
              <small class="text-muted">Facultatif, mais recommandé pour les communications.</small>
            </div>
          </div>
        </div>

        <!-- Justificatif -->
        <h4 class="mt-3">Justificatif de résidence</h4>
        <p class="mb-1"><small>Chargez un document confirmant que vous résidez dans la Somme (80), l’Oise (60) ou l’Aisne (02) : carte d’étudiant, certificat d’inscription, facture récente, attestation de logement, quittance de loyer, justificatif d’identité avec adresse, etc. Vous pouvez masquer toute information non nécessaire.</small></p>

        <div class="form-group mb-3">
          <label class="form-label" for="justificatif">Téléverser le justificatif <span class="text-danger">*</span></label>
          <input type="file" class="form-control" id="justificatif" name="justificatif" accept=".pdf,.png,.jpg,.jpeg,.webp" required />
          <small class="text-muted">Formats acceptés : PDF, JPG, PNG, WEBP (max. 10 Mo).</small>
        </div>

        <!-- Commentaires -->
        <div class="form-group mb-3">
          <label class="form-label" for="commentaires">Commentaires (facultatif)</label>
          <textarea class="form-control" id="commentaires" name="commentaires" rows="4" placeholder="Ajoutez une précision utile…"></textarea>
        </div>

        <!-- RGPD -->
        <h4 class="mt-4">Traitement des données personnelles</h4>
        <ul class="mb-2">
          <li>Les données sont destinées exclusivement à l’ASA pour la gestion des adhésions et des communications internes.</li>
          <li>Elles sont conservées le temps strictement nécessaire à la gestion de votre adhésion.</li>
          <li>Vous disposez d’un droit d’accès, de rectification, d’opposition, de limitation et de suppression : <a href="mailto:associationsenegalaisdamiens@gmail.com">associationsenegalaisdamiens@gmail.com</a>.</li>
        </ul>

        <div class="form-check mb-3">
          <input type="checkbox" class="form-check-input" id="consentement" name="consentement" value="Oui" required />
          <label class="form-check-label" for="consentement">Je confirme avoir pris connaissance des informations ci-dessus et j’y consens. *</label>
        </div>

        <div id="loadingMessage" style="display:none; text-align:center; margin-top:10px;">
          <p><strong>Envoi en cours…</strong></p>
        </div>

        <button type="submit" class="btn btn-primary btn-submit w-100 mt-2">Envoyer ma demande d’adhésion</button>
      </form>
    </div>

    <div class="text-center mb-5">
      <span class="copyright" title="ASA • Association des Sénégalais d'Amiens">© 2025 • Association des Sénégalais d’Amiens (ASA)</span>
    </div>

    <!-- Script du formulaire -->
    <script>
      const form = document.getElementById("asaForm");
      const prenomInput = document.getElementById("prenom");
      const nomInput = document.getElementById("nom");
      const justificatifInput = document.getElementById("justificatif");

      // Prénom : capitaliser chaque mot (et parties composées)
      prenomInput.addEventListener("input", function () {
        this.value = this.value
          .toLowerCase()
          .split(" ")
          .map((w) =>
            w
              .split("-")
              .map((p) => (p ? p.charAt(0).toUpperCase() + p.slice(1) : ""))
              .join("-")
          )
          .join(" ");
      });

      // Nom : forcer majuscules
      nomInput.addEventListener("input", function () {
        this.value = this.value.toUpperCase();
      });

      // Contrôle taille du fichier (10 Mo)
      justificatifInput.addEventListener("change", () => {
        const f = justificatifInput.files?.[0];
        if (f && f.size > 10 * 1024 * 1024) {
          Swal.fire({
            icon: "warning",
            title: "Fichier trop volumineux",
            text: "Veuillez choisir un fichier de 10 Mo maximum.",
            confirmButtonColor: "#00853F",
          });
          justificatifInput.value = "";
        }
      });

      // Soumission
      form.addEventListener("submit", async (e) => {
        //e.preventDefault();

        const submitButton = form.querySelector(".btn-submit");
        const originalText = submitButton.textContent;
        const loading = document.getElementById("loadingMessage");

        submitButton.disabled = true;
        submitButton.textContent = "Envoi en cours…";
        loading.style.display = "block";

        try {
          const data = new FormData(form);

          /*// Envoi vers Apps Script Web App
          const response = await fetch(form.action, {
            method: "POST",
            body: data,
          });**/

          // Si le Web App renvoie JSON : { result: "success" | "error", message: "..."}
          const result = await response.json();

          if (result.result === "success") {
            Swal.fire({
              icon: "success",
              title: "Adhésion envoyée",
              text: "Merci ! Votre demande d’adhésion a bien été transmise à l’ASA.",
              confirmButtonColor: "#00853F",
            });
            form.reset();
          } else {
            Swal.fire({
              icon: "error",
              title: "Erreur",
              text: result.message || "Une erreur est survenue. Veuillez réessayer.",
              confirmButtonColor: "#00853F",
            });
          }
        } catch (err) {
          console.error(err);
          Swal.fire({
            icon: "warning",
            title: "Problème réseau",
            text: "Envoi impossible pour le moment. Vérifiez votre connexion et réessayez.",
            confirmButtonColor: "#00853F",
          });
        } finally {
          submitButton.disabled = false;
          submitButton.textContent = originalText;
          loading.style.display = "none";
        }
      });
    </script>
  </body>
</html>
